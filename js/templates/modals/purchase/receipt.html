<hr class="clrBr">
<b><%= ob.polyT('purchase.receipt.summary') %></b>
<%
  const viewingCurrency = ob.currencyMod.getCurrencyValidity(ob.displayCurrency) === 'VALID' ?
    ob.displayCurrency : ob.listingCurrency;

  ob.prices.forEach((priceObj, i) => {
    const shippingPrice = ob.currencyMod.convertCurrency(priceObj.sPrice, ob.listingCurrency, viewingCurrency);
    const additionalShippingPrice = ob.currencyMod.convertCurrency(priceObj.aPrice, ob.listingCurrency, viewingCurrency);
    // shippingTotal
    
    const quantity = Number.isInteger(priceObj.quantity) && priceObj.quantity > 0 ? priceObj.quantity : 1;
%>
  <div class="flexRow gutterHSm">
    <span class="flexExpand">
      <% if (!ob.isCrypto) { %>
        <%= ob.polyT('purchase.receipt.listing') %>
      <% } else { %>
        <%= ob.polyT('purchase.receipt.cryptoIconsAmountCombo', {
          icons: ob.crypto.tradingPair({
            className: 'cryptoTradingPairSm cryptoTradingPair',
            fromCur: ob.listing.metadata.acceptedCurrencies[0],
            toCur: ob.listing.metadata.coinType,
            truncateCurAfter: 5,
          }),
          cryptoAmount:
            `<span class="cryptoQuantity">${ob.polyT('purchase.receipt.cryptoAmount',
              { amount: '<span class="js-cryptoQuantity"></span>' })}</span>`,
        }) %>

      <% } %>
    </span>
    <div class="constrainedWidth">
      <div class="flexHRight">
        <b>
          <% print(
            ob.isCrypto ?
              '<span class="js-cryptoTotal"></span>' :
              '<span class="js-listingPrice"></span>'
          ) %>
        </b>
      </div>
    </div>
  </div>
  <% ob.coupons.forEach((coupon) => { %>
    <div class="flexRow gutterHSm">
      <span class="flexExpand">
        <%= ob.polyT('purchase.receipt.coupon') %>
      </span>
      <div class="constrainedWidth">
        <div class="flexHRight">
          <b>
            <% if (coupon.percentDiscount) {
              print(`-${coupon.percentDiscount}%`);
            } else if (coupon.priceDiscount) { %>
              <span class="js-couponPrice" data-coupon-hash="<%= coupon.hash %>"></span>
            <% } %>
          </b>
        </div>
      </div>
    </div>
  <% }); %>

  <% if (ob.listing.shippingOptions && ob.listing.shippingOptions.length && shippingPrice !== additionalShippingPrice && quantity > 1) { %>
  <div class="flexRow gutterHSm">
        <span class="flexExpand">
          <%= ob.polyT('purchase.receipt.shipping') %>
        </span>
  </div>
  <div class="flexRow subShipping gutterHSm">
    <span class="flexExpand">
      <%= ob.polyT('purchase.receipt.firstItem') %>
    </span>
    <div class="constrainedWidth">
      <div class="flexHRight">
        <b class="js-shippingPrice"></b>
      </div>
    </div>
  </div>
  <div class="flexRow subShipping gutterHSm">
    <span class="flexExpand">
      <%= ob.polyT('purchase.receipt.additionalItems') %>
    </span>
    <div class="constrainedWidth">
      <div class="flexHRight">
        <b class="js-additionalShippingPrice"></b>
      </div>
    </div>
  </div>
  <% } else if (ob.listing.shippingOptions && ob.listing.shippingOptions.length) { %>
    <div class="flexRow gutterHSm">
      <span class="flexExpand">
        <%= ob.polyT('purchase.receipt.shipping') %>
      </span>
      <div class="constrainedWidth">
        <div class="flexHRight">      
          <b class="js-shippingPrice"></b>
        </div>
      </div>
    </div>
  <% } %>
  <hr class="clrBr">
  <% if (quantity) { %>
    <% if (!ob.isCrypto) { %>
      <div class="flexRow gutterHSm">
        <span class="flexExpand">
          <%= ob.polyT('purchase.receipt.subtotal',
            { quantity: '<span class="js-quantity"></span>' }) %>
        </span>
        <div class="constrainedWidth">
          <div class="flexHRight">      
            <b class="js-subTotal"></b>
          </div>
        </div>
      </div>
    <% } %>
    <% if (ob.listing.shippingOptions && ob.listing.shippingOptions.length && ob.shippingTotal) { %>
      <div class="flexRow gutterHSm">
        <span class="flexExpand">
          <%= ob.polyT('purchase.receipt.shippingTotal') %>
        </span>
        <div class="constrainedWidth">
          <div class="flexHRight">        
            <b class="js-shippingTotal"></b>
          </div>
        </div>
      </div>
    <% } %>
  <% } %>
  <div class="flexRow">
    <span class="flexExpand">
      <%= ob.polyT('purchase.receipt.total') %>
    </span>
    <div class="constrainedWidth">
      <div class="flexHRight">    
        <b class="js-totalPrice"></b>
      </div>
    </div>
  </div>
<% }); %>
